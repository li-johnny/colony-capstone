<ImageContainerWidget>:
    id: image_container
    canvas.before:
        Color:
            rgba: 1, 0, 0, 1  # Red background, for example
        Rectangle:
            pos: self.pos
            size: self.size
        #border lines for the selected image
        Color:
            rgba: self.border_color  # Set the color to blue for the border (only selected image)
        Line:
            rectangle: self.x+1, self.y+1, self.width-2, self.height-2
            width: 8.0 

    RelativeLayout:
        Button:
            id: invisible_button
            opacity: 0
            on_release: root.previewer_update()
        BoxLayout:
            id: swap
            AsyncImage:
                id: async_image
                source: root.source
                size_hint: (1, 1)
                fit_mode: 'cover'
        AnchorLayout:
            anchor_x: 'right'
            anchor_y: 'top'
            padding: 0, 10, 10, 0
            DefaultButton:
                text: "X"
                font_size: 14
                size_hint: (0.15, 0.15)
                on_release: root.remove()

# Contains the previewer window with a zoomable image
<PreviewerContainer>
    previewer: previewer.__self__
    id: prevSwap
    pos: root.parent.pos
    size: previewer.size
    do_rotation: False
    RelativeLayout:
        id: relativeContainer
        size: root.parent.width, root.parent.height
        AsyncImage:
            id: previewer
            size: root.parent.width, root.parent.height
            source: None
            opacity: 0

# Container for colony count and edit button
<InfoContainer>
    id: info_container
    size_hint: (0.4, 1)
    orientation: 'vertical'
    padding: 0, 0, 20, 0

    # Spacer widget for space at the top
    Widget:
        size_hint_y: None
        height: 50

    BoxLayout:
        id: colonies_detected_section
        size_hint_y: 0.3
        # height: 250  # Fixed height to maintain size
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: (0.3, 0.3, 0.3, 1)
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: [30]

        Widget:
            size_hint_y: 1

        Label:
            text: "Colonies Detected:"
            font_size: 40
            halign: 'center'
            valign: 'bottom'
            size_hint_y: None
            height: self.texture_size[1]

        Label:
            id: colony_count_text
            text: "XX"
            font_size: 40
            halign: 'center'
            valign: 'top'
            size_hint_y: None
            height: self.texture_size[1]

        Widget:
            size_hint_y: 1


    # Spacer widget
    Widget:
        size_hint_y: None
        height: 50

    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        id: edit_button
        # opacity: 0 if root.tools_visible else 1  # Hide when tools are visible
        DefaultButton:
            size_hint: (1, 0.3)
            # height: 200
            text: "Edit"
            font_size: 60
            on_release: root.toggle_tools()
            background_color: (0.5, 0.5, 0.5, 0)  # Makes the default button background transparent
            canvas.before:
                Color:
                    rgba: (0.3, 0.3, 0.3, 1)  # Button color
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [30]

    BoxLayout:
        orientation: 'vertical'
        size_hint: (1, 0.6)

        id: tools_layout
        # pos_hint: {'top': 1}  # Position at the top where the Edit button was
        opacity: 0 # if root.tools_visible else 0  # Show only when tools are visible
        canvas.before:
            Color:
                rgba: (0.3, 0.3, 0.3, 1) # Example: light grey background color
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [30]

        # Label for the "Tools" section
        Label:
            text: "[u] Tools [/u]"
            font_size: 60
            size_hint_y: None
            height: 100
            halign: 'center'
            valign: 'middle'
            markup: True


        GridLayout:
            cols: 2  # Arrange icons in 2 colmuns
            size_hint: (1, 1)
            opacity: 1 if root.tools_visible else 0  # Show only when tools are visible

            BoxLayout:
                orientation: 'vertical'

                ImageButton:
                    source: 'img/add_icon.png'
                    on_press: root.add_colony()
                    size_hint: (1, 0.7)

                Label:
                    text: 'Add Colony'
                    size_hint_y: 0.2
                    valign: 'middle'
                    halign: 'center'

                Widget:
                    size_hint_y: 0.1
                    # height: 20

            BoxLayout:
                orientation: 'vertical'
                spacing: 10  # Space between children

                ImageButton:
                    source: 'img/zoomin_icon.png'
                    on_press: root.zoom_in() ; app.myLayout.ids.prevContainer.zoom_in()
                    size_hint: (1, 0.7)

                Label:
                    text: 'Zoom In'
                    size_hint_y: 0.2
                    valign: 'middle'
                    halign: 'center'

                Widget:
                    size_hint_y: 0.1


            BoxLayout:
                orientation: 'vertical'

                ImageButton:
                    source: 'img/remove_icon.png'
                    on_press: root.remove_colony()
                    size_hint: (1, 0.7)

                Label:
                    text: 'Remove Colony'
                    size_hint_y: 0.2
                    valign: 'middle'
                    halign: 'center'
                    text_size: self.width, None

                Widget:
                    size_hint_y: 0.1

            BoxLayout:
                orientation: 'vertical'

                ImageButton:
                    source: 'img/zoomout_icon.png'
                    on_press: root.zoom_out() ; app.myLayout.ids.prevContainer.zoom_out()
                    size_hint: (1, 0.7)

                Label:
                    text: 'Zoom Out'
                    size_hint_y: 0.2
                    valign: 'middle'
                    halign: 'center'

                Widget:
                    size_hint_y: 0.1

            BoxLayout:
                orientation: 'vertical'

                ImageButton:
                    source: 'img/fullscreen_icon.png'if not root.fullscreen_mode else 'img/exit_fullscreen_icon.png'
                    on_press: root.full_screen()
                    size_hint: (1, 0.7)

                Label:
                    text: 'Full Screen'
                    size_hint_y: 0.2
                    valign: 'middle'
                    halign: 'center'

                Widget:
                    size_hint_y: 0.1


            BoxLayout:
                orientation: 'vertical'

                ImageButton:
                    source: 'img/on_icon.png' if root.toggle_state else 'img/off_icon.png'
                    on_press: root.switch_toggle() ; app.myLayout.toggle_images()
                    size_hint: (1, 0.7)

                Label:
                    text: 'Toggle View'
                    size_hint_y: 0.2
                    valign: 'middle'
                    halign: 'center'

                # Spacer widget
                Widget:
                    size_hint_y: 0.1

    # Spacer widget
    Widget:
        id: spacer_under_infocontainer
        size_hint_y: 0.01




<MyGridLayout>
    id: my_grid_layout
    GridLayout:
        id: main_grid
        cols: 2
        size: root.width, root.height


        # Imported images container on the left side of the screen
        ScrollView:
            id: image_scroll_view
            size_hint: (0.4, 1)
            canvas.before:
                Color:
                    rgba: 0.2, 0.2, 0.25, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            GridLayout:
                id: image_box
                cols: 2
                spacing: 10
                padding: [10, 10, 10, 10]
                size_hint: (0.95, None)
                height: self.minimum_height
                row_default_height: self.width/2
                col_default_width: self.width/2

        # Right side of the screen with image previewer and upload/process buttons
        GridLayout:
            cols: 1
            size_hint: (1, 1)
            GridLayout:

                cols: 2
                id: right_side_layout
                canvas.before:
                    Color:
                        # rgba: 0.286, 0.361, 0.51, 1
                        rgba: 0.286, 0.361, 0.51, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                StencilView:
                    PreviewerContainer:
                        id: prevContainer

            GridLayout:
                cols: 3
                size_hint: (1, 0.3)
                id: upload_process_container
                canvas.before:
                    Color:
                        # rgba: 0.286, 0.361, 0.51, 1
                        rgba: 0.286, 0.361, 0.51, 1  # Set to the same color as cols: 2
                    Rectangle:
                        pos: self.pos
                        size: self.size

                AnchorLayout:
                    # padding: [padding_left, padding_top, padding_right, padding_bottom]
                    padding: 180, 0, 40, 0
                    DefaultButton:
                        id: upload_button
                        text: "Upload"
                        font_size: 80
                        size_hint: (1, 0.5)
                        on_release: root.file_explorer_or_cancel()
                        background_color: (0.5, 0.5, 0.5, 0)  # Makes the default button background transparent
                        canvas.before:
                            Color:
                                rgba: (0.3, 0.3, 0.3, 1)  # Button color
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [30]



                AnchorLayout:
                    padding: 40, 0, 180, 0
                    DefaultButton:
                        id: process_button
                        text: "Process"
                        font_size: 80
                        size_hint: (1, 0.5)
                        on_release: root.on_process_button_press()
                        background_color: (0.5, 0.5, 0.5, 0)  # Makes the default button background transparent
                        canvas.before:
                            Color:
                                rgba: (0.3, 0.3, 0.3, 1)  # Button color
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [30]
